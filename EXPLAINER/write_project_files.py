#!/usr/bin/env python3
"""
write_project_files.py
Writes SPEC.md, scene.toml, and context_capsule.txt into the current directory.

Usage:
  python write_project_files.py
"""
from pathlib import Path

README = 'These are the portable “project capsule” text files for SYNTHMOON (currently v0.1.x).\n\nThey are meant to be handed to a new ChatGPT/AI session to restore context quickly.\n\nFiles:\n- SPEC.md              Project specification + current v0.1.x design/behaviour\n- scene.toml           Central configuration template (v0.1.2-capable)\n- context_capsule.txt  Short pasteable summary for a fresh chat\n- README.txt           This file\n- write_project_files.py  Recreates the above files locally (no copy/paste)\n\nUsage (to recreate locally):\n    python write_project_files.py\n\nNotes:\n- The actual code lives in your git repo. These docs are the “why/what/how” memory.\n- Keep large data (LROC/LOLA) out of git; use download scripts + .gitignore.\n'
SPEC = '# SPEC.md — SYNTHMOON: Synthetic Moon Images with Sunlight + Earthlight (Earthshine)\n\n## Goal\nBuild a modular Python renderer that generates synthetic **512×512** Moon images with **1°×1°** field of view, as seen from a specified observer (Earth site or spacecraft). Illumination includes **direct sunlight** and **earthlight** (sunlight reflected by Earth). Geometry must come from **SPICE**.\n\n## Non-negotiables\n- One UTC timestamp per image; store **full Julian Date** in FITS header as **JD-OBS** formatted **f15.7** (no MJD).\n- Compute in **floating point** throughout (earthshine is faint).\n- Output is **DS9-friendly FITS** and must not silently quantise to int16.\n\n## Current v0.1.x behaviour (what exists now)\n### Geometry\n- Uses SpiceyPy with a small generic NAIF kernel set (LSK + PCK + planetary SPK).\n- Observer:\n  - Earth site lon/lat/height OR spacecraft inertial state.\n- Camera:\n  - Pinhole/gnomonic rays; pointing set to Moon centre; roll supported.\n\n### Moon surface\n- Base surface is a sphere of radius `moon.radius_km`.\n- **Lunar albedo map** supported via an equirectangular FITS (e.g., LROC WAC 643 nm mosaic converted to FITS).\n- **Orography (LOLA DEM)**:\n  - LOLA LDEM_16 global DEM converted to FITS.\n  - Ray–Moon hit is refined using a “sphere + DEM displacement” iteration.\n  - Surface normals derived from DEM slopes (finite differences) for Lambert shading.\n  - Diagnostic layers: elevation (metres) and slope (degrees).\n\n### Illumination\n- Sunlight and earthlight can be toggled independently.\n- **Earthlight** treats Earth as an extended disk and integrates over disk samples; uses tile caching for speed.\n- **Sun as extended disk** (finite solar diameter):\n  - Adaptive disk sampling only in the narrow partial-visibility band near terminator/horizon.\n  - Else point-source Sun is used for speed.\n\n### Shadowing\n- v0.1.x uses simple geometric horizon tests.\n- Planned: DEM-based terrain self-shadowing for both Sun and Earthlight directions (hard shadows first, then penumbra).\n\n### Output format\n- Writes a single **FITS cube in the PRIMARY HDU** (NAXIS=3). Layer names are stored as `LAY1..LAYN` keywords.\n- Primary layers are stored as **float32/float64**; an optional “scaled for viewing” layer maps values to **0..65535** (still float).\n- Typical layers include:\n  - SCALED (0..65535 float for viewing)\n  - IFTOTAL, IF_SUN, IF_EARTH (dimensionless I/F)\n  - RADTOT, RAD_SUN, RAD_EAR (broadband radiance, W m⁻² sr⁻¹; TSI-based)\n  - ALBMOON (albedo actually used per pixel)\n  - ELEV_M (metres) and SLOPDEG (degrees) when DEM is enabled\n- FITS headers include JD-OBS, DATE-OBS, kernel provenance, and key config settings.\n\n## Performance principles\n- Early-out for rays that miss the Moon (bounding sphere).\n- Optional tile caching for earthlight disk integration.\n- Adaptive sampling for extended Sun (only near terminator).\n\n## Planned upgrades\n1) Terrain self-shadowing (DEM horizon/ray test) for Sun and Earthlight.\n2) Hapke photometry for the Moon (spatially varying parameter maps later).\n3) Spectral/filtered rendering: wavelength grid + solar spectrum + wavelength-dependent BRDFs.\n4) Better Earth model: map-based albedo + clouds + later glint and spectral reflectance.\n'
SCENE = '[time]\n# One UTC per exposure (milliseconds). Stored to FITS as DATE-OBS and JD-OBS (full JD, f15.7).\nutc = "2026-02-13T03:12:45Z"\n\n[observer]\n# "earth_site" uses lon/lat/height on Earth (IAU_EARTH).\n# "spacecraft_state" uses an inertial state vector you supply.\nmode = "earth_site"  # "earth_site" | "spacecraft_state"\nlon_deg = 12.5683\nlat_deg = 55.6761\nheight_m = 20.0\n\n# If spacecraft_state:\n# frame = "J2000"\n# x_km = 0.0\n# y_km = 0.0\n# z_km = 0.0\n# vx_km_s = 0.0\n# vy_km_s = 0.0\n# vz_km_s = 0.0\n\n[camera]\nnx = 512\nny = 512\nfov_deg = 1.0\nroll_deg = 0.0\npointing = "moon_center"  # currently supported: "moon_center"\n\n[paths]\nspice_kernels_dir = "KERNELS"\nmeta_kernel = "KERNELS/generic.tm"\nout_fits = "OUTPUT/synth_moon_v0.fits"\n\n[moon]\nradius_km = 1737.4\nbrdf = "lambert"     # later: "hapke"\n\n# Constant albedo (used if albedo_map_fits not set)\nalbedo = 0.12\n\n# Optional lunar albedo map (equirectangular FITS). Example: LROC WAC 643 nm mosaic converted to FITS.\n# albedo_map_fits = "DATA/moon_albedo_lroc_wac643_016ppd_mean0p12.fits"\n# albedo_map_lon_mode = "-180_180"   # "-180_180" or "0_360"\n# albedo_map_scale = 1.0\n\n# Optional lunar DEM (LOLA LDEM_16 converted to FITS; values are radius in metres).\n# dem_fits = "DATA/moon_dem_lola_ldem16_m.fits"\n# dem_lon_mode = "0_360"   # LOLA cylindrical products are typically 0..360E\n# dem_units = "m"\n# dem_scale = 1.0          # set >1 temporarily to exaggerate relief for debugging\n# dem_refine_iter = 3      # 2–4 reasonable\n\n[earth]\nradius_km = 6378.1366\nbrdf = "lambert"\n\n# Base Earth albedo scale (multiplicative)\nalbedo = 0.30\n\n# Earth treated as an extended disk for earthlight integration\nearth_disk_samples = 192\n\n# Tile caching size (pixels); 16 is a good default; 1 disables caching\nearthlight_tile_px = 16\n\n# Optional Earth albedo map FITS (equirectangular). If omitted, a toy land/ocean + clouds model may be used.\n# albedo_map_fits = "DATA/earth_albedo.fits"\n# albedo_map_lon_mode = "0_360"\n# land_albedo = 0.25\n# ocean_albedo = 0.06\n# cloud_amount = 0.3     # 0..1\n# cloud_albedo = 0.6\n\n[sun]\n# Extended solar disk (finite angular size) matters near the terminator/horizon.\nextended_disk = true\ndisk_samples = 64\nradius_km = 695700.0\n\n[illumination]\ninclude_sun = true\ninclude_earthlight = true\n\n[shadows]\n# v0.1.x: simple geometric horizon tests; terrain self-shadowing is a planned upgrade\nmode = "simple"\n\n[output]\n# Keep computations float. For convenient viewing in DS9, the primary cube is scaled to 0..65535 in float.\nprimary_dtype = "float32"          # "float32" or "float64"\nprimary_scaled_0_65535 = true\nstore_raw_extension = true         # store unscaled physical-ish layer(s) as extra extension if implemented\nwrite_cube = true                  # write a multi-layer cube in the primary HDU\nbunit = "I/F_moon"                 # unit label for the primary scaled layer (actual physical units are in other layers)\n'
CAPSULE = 'SYNTHMOON (v0.1.x) summary — paste into a new chat to restore context\n\nGoal\n- Modular Python renderer for synthetic lunar images (512×512, 1°×1° FOV) with correct SPICE geometry.\n- Illumination includes sunlight and earthlight (earthshine). Earth and Sun can be treated as extended disks near horizons/terminator.\n- Compute in float throughout; write DS9-friendly FITS output.\n\nCurrent implemented features (v0.1.2-ish)\n- SPICE geometry via SpiceyPy + generic NAIF kernels (LSK/PCK + planetary SPK).\n- Observer: Earth site lon/lat/height or spacecraft state.\n- Camera: pinhole/gnomonic; pointing=moon_center; roll supported.\n- Moon albedo:\n  - Constant albedo OR map-based albedo from an equirectangular FITS (e.g., LROC WAC 643 nm mosaic converted to FITS).\n- Moon orography:\n  - LOLA LDEM_16 global DEM converted to FITS; per-ray hit-point refinement (sphere + DEM) and DEM-based normals for Lambert shading.\n  - Writes diagnostic layers: ELEV_M, SLOPDEG.\n- Earthlight:\n  - Earth treated as extended disk; disk quadrature with tile caching; early-outs when Earth below local horizon.\n- Sun:\n  - Supports extended solar disk sampling in the narrow partial-visibility band near the terminator/horizon (adaptive), otherwise uses point-source (fast).\n- Output:\n  - Writes a single FITS cube in the primary HDU (NAXIS=3) with named layers (LAY1..).\n  - Primary values are floats scaled to 0..65535 for easy viewing; additional layers include I/F and broadband radiance (TSI-based) plus component splits (Sun/Earth) and ALBMOON.\n  - JD-OBS stored as full JD with decimals (f15.7), no MJD.\n\nWorkflow\n- Runs with uv (no manual venv activation): PYTHONPATH=$PWD uv run python -m synthmoon.run_v0 --config scene.toml\n- Use git tags to pin working states (e.g., v0.1.0, v0.1.2) and a “panic runner” script to return to known-good versions.\n'

def write(path: str, text: str) -> None:
    Path(path).write_text(text, encoding="utf-8")

def main() -> None:
    write("README.txt", README)
    write("SPEC.md", SPEC)
    write("scene.toml", SCENE)
    write("context_capsule.txt", CAPSULE)
    print("Wrote: README.txt, SPEC.md, scene.toml, context_capsule.txt")

if __name__ == "__main__":
    main()
